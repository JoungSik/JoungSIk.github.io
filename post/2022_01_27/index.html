<!DOCTYPE html>
<html lang="ko-kr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script type="application/javascript" src='https://joungsik.github.io/js/theme-mode.js'></script>
    <link rel="stylesheet" href='https://joungsik.github.io/css/frameworks.min.css' />
    <link rel="stylesheet" href='https://joungsik.github.io/css/github.min.css' />
    <link rel="stylesheet" href='https://joungsik.github.io/css/github-style.css' />
    <link rel="stylesheet" href='https://joungsik.github.io/css/light.css' />
    <link rel="stylesheet" href='https://joungsik.github.io/css/dark.css' />
    <link rel="stylesheet" href='https://joungsik.github.io/css/syntax.css' />
    <title>토비의 스프링 - 6장 (2) - JoungSik</title>
    
    <link rel="icon" type="image/x-icon" href='/images/github.png'>
    
    <meta name="theme-color" content="#1e2327">
    <meta name="naver-site-verification" content="897620aba8ba7aa292baac576c13b337c3c0b021" />

    
    <meta name="description"
  content="토비의 스프링 - 6장 (2)" />
<meta name="keywords"
  content='spring' />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://joungsik.github.io/post/2022_01_27/" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="토비의 스프링 - 6장 (2) - JoungSik" />
<meta name="twitter:description"
  content="토비의 스프링 - 6장 (2)" />
<meta name="twitter:site" content="https://joungsik.github.io/" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image"
  content="https://joungsik.github.io/">


<meta property="og:type" content="article" />
<meta property="og:title" content="토비의 스프링 - 6장 (2) - JoungSik">
<meta property="og:description"
  content="토비의 스프링 - 6장 (2)" />
<meta property="og:url" content="https://joungsik.github.io/post/2022_01_27/" />
<meta property="og:site_name" content="토비의 스프링 - 6장 (2)" />
<meta property="og:image"
  content="https://joungsik.github.io/">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2022-01-27 20:05:02 &#43;0900 KST" />











<script async src="https://www.googletagmanager.com/gtag/js?id=G-DL4SWDGV72"></script>
<script>
  if (navigator.doNotTrack !== '1') {
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-DL4SWDGV72');
  }
</script>



</head>

<body>
  <div style="position: relative">
  <header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on">
    <div class="Header-item mobile-none" style="margin-top: -4px; margin-bottom: -4px;">
      <a class="Header-link" href="https://joungsik.github.io/">
        <svg class="octicon" height="32" viewBox="0 0 16 16" version="1.1" width="32">
          <path fill-rule="evenodd"
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
          </path>
        </svg>
      </a>
    </div>
    <div class="Header-item d-md-none">
      <button class="Header-link btn-link js-details-target" type="button"
        onclick="document.querySelector('#header-search').style.display = document.querySelector('#header-search').style.display == 'none'? 'block': 'none'">
        <svg height="24" class="octicon octicon-three-bars" viewBox="0 0 16 16" version="1.1" width="24">
          <path fill-rule="evenodd"
            d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z">
          </path>
        </svg>
      </button>
    </div>
    <div style="display: none;" id="header-search"
      class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex">
      <div
        class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to">
        <div class="position-relative">
          <form target="_blank" action="https://www.google.com/search" accept-charset="UTF-8" method="get"
            autocomplete="off">
            <label
              class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center">
              <input type="text"
                class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
                name="q" value="" placeholder="Search" autocomplete="off">
              <input type="hidden" name="q" value="site:https://joungsik.github.io/">
            </label>
          </form>
        </div>
      </div>
    </div>

    <div class="Header-item Header-item--full flex-justify-center d-md-none position-relative">
      <a class="Header-link " href="https://joungsik.github.io/">
        <svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" version="1.1"
          width="32">
          <path fill-rule="evenodd"
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
          </path>
        </svg>
      </a>
    </div>
    <div class="Header-item" style="margin-right: 0;">
      <a href="javascript:void(0)" class="Header-link no-select" onclick="switchTheme()">
        <svg style="fill: var(--color-profile-color-modes-toggle-moon);" class="no-select" viewBox="0 0 16 16"
          version="1.1" width="16" height="16">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z">
          </path>
        </svg>
      </a>
    </div>
  </header>
</div>
  
<div>
  <main>
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
      <div class="px-0">
        <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
          <div class="flex-auto min-width-0 width-fit mr-3">
            <div class="d-flex">
              <div class="d-none d-md-block">
                <a class="avatar mr-2 flex-shrink-0" href="https://joungsik.github.io/">
                  <img class=" avatar-user"
                    src="https://avatars.githubusercontent.com/u/6128807?v=4"
                    width="32" height="32"></a>
              </div>
              <div class="d-flex flex-column">
                <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                  <span class="author">
                    <a href="https://joungsik.github.io/">JoungSik</a></span><span
                    class="path-divider">/</span><strong class="css-truncate-target mr-1" style="max-width: 410px"><a
                      href="https://joungsik.github.io/post/2022_01_27/">토비의 스프링 - 6장 (2)</a></strong>
                </h1>
                <div class="note m-0">
                  Created <relative-time datetime="Thu, 27 Jan 2022 20:05:02 &#43;0900"
                    class="no-wrap">
                    Thu, 27 Jan 2022 20:05:02 &#43;0900</relative-time>

                  
                  <span class="file-info-divider"></span>
                  Modified <relative-time datetime="Thu, 27 Jan 2022 20:05:28 &#43;0900"
                    class="no-wrap">
                    Thu, 27 Jan 2022 20:05:28 &#43;0900</relative-time>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-lg px-3 new-discussion-timeline">
      <div class="repository-content gist-content">
        <div>
          <div class="js-gist-file-update-container js-task-list-container file-box">
            <div id="file-pytest" class="file my-2">
              <div id="post-header" class="file-header d-flex flex-md-items-center flex-items-start sticky-header" style="z-index: 2">
                <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
                  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                    
                    <summary id="toc-toggle" onclick="clickToc()" class="btn btn-octicon m-0 mr-2 p-2">
                      <svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16" class="octicon octicon-list-unordered">
                        <path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zM3 8a1 1 0 11-2 0 1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"></path>
                      </svg>
                    </summary>
                    <details-menu class="SelectMenu" id="toc-details" style="display: none;">
                      <div class="SelectMenu-modal rounded-3 mt-1" style="max-height: 340px;">
                        <div class="SelectMenu-list SelectMenu-list--borderless p-2" style="overscroll-behavior: contain;" id="toc-list">
                        </div>
                      </div>
                    </details-menu>
                      1570 Words
                    

                  </div>
                  <div class="file-actions flex-order-2 pt-0">
                    
                    
                    <a class="muted-link mr-3" href="/tags/spring">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      spring
                    </a>
                    
                    
                  </div>
                </div>
              </div>


              <div class="Box-body px-5 pb-5" style="z-index: 1">
                <article class="markdown-body entry-content container-lg"><h1 id="토비의-스프링---6장-2">토비의 스프링 - 6장 (2)</h1>
<p>이번 장은 2~3번에 나눠서 올리게 되었습니다.</p>
<p>먼저 프록시 패턴과 데코레이터 패턴을 설명하려고 합니다. 프록시는 이전 책에서 이야기가 나온적이 있습니다. 바로 전의 트랜잭션 기능과 비지니스 로직을 분리해서 기능을 구현 했었던 적이 있었는데 이때 핵심 기능을 인터페이스화 해 부가 기능이 마치 핵심 기능인 것처럼 위장하고 클라이언트의 요청을 대신 받아주는 대리자와 같은 역할을 하는 코드가 있었습니다. 이 부분을 프록시라고 이야기 합니다.</p>
<p>이런 프록시를 사용하는 목적에는 크게 2가지로 구분 할 수 있습니다.</p>
<p>클라이언트가 타겟에 접근하는 방법을 제어하기 위한 것과 타겟에 부가적인 기능을 부여하기 위해서 쓰이게 됩니다. 다만 이 2가지 목적은 디자인 패턴에선  다른 패턴으로 구분되는데 이것이 프록시 패턴과 데코레이터 패턴입니다.</p>
<p>프록시 패턴은 이러한 프록시 목적 중 클라이언트가 타겟에 접근하는 방법을 제어하려는 목적에 해당할 때 사용하게 됩니다. 그리고 데코레이터 패턴은 부가적인 기능을 부여하기 위한 목적을 가지고 있을 때 사용하게 됩니다.</p>
<p>먼저 데코레이터 패턴으로 불리는 이유는 부가기능들이 마치 제품을 여러 겹으로 포장하고 장식을 붙이는 것처럼 보이는게 데코를 붙이는 것처럼 보이기 때문입니다. 이전에 프록시를 사용했던 코드가 이러한 데코레이터 패턴을 사용했다고 볼 수 있습니다. 그리고 데코레이터 라고 불리는만큼 타겟의 코드를 변경하지 않고 새로운 기능을 추가 할 때 유용한 방법입니다.</p>
<p>다음은 프록시 패턴입니다. 남은 목적 중 하나인 타겟에 대한 접근 방식을 제어하는 목적으로 쓰이게 됩니다. 특정 레이어에서는 읽기전용으로만 코드를 강제 해야 할 때 쓰기 기능을 사용하려고 할때 이런 기능을 동작하지 못하도록 제어할 때 사용하게 됩니다. 이는 즉 타겟의 기능 자체에는 관여하지 않으면서 접근하는 방식만 제어합니다.</p>
<p>이런 프록시를 사용하는데에 생기는 문제 중에는 타겟의 인터페이스를 구현하고 위임하는 코드를 작성하는게 번거롭고 부가 기능을 사용하지 않는 메소드도 구현해야 하는 등 코드의 양이 늘어나고 부가기능에 해당하는 코드가 중복될 가능성이 높아지게 됩니다. 그래서 이런 것을 관리하기 위해서 리플랙션 기능을 사용해 프록시를 만드는 다이나믹 프록시를 사용하게 됩니다.</p>
<p>다이나믹 프록시를 사용하게 된다면 가장 중요한 리플랙션이 뭔지를 알아보겠습니다. 리플랙션은 구체적인 클래스 정보는 알지 못해도 컴파일 된 자바 바이트 코드를 이용해 클래스에 대한 정보를 얻어내 클래스를 사용하는 기법을 말합니다.</p>
<p>다이나믹 프록시를 구현할 때는 InvocationHandler 를 구현하면 됩니다.</p>
<p>그리고 클라이언트에서 타겟을 받을 때는 Proxy 클래스의 newProxyInstance() 를 통해 받으면 됩니다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">Object</span> <span class="n">object</span> <span class="o">=</span> <span class="o">(</span><span class="n">Object</span><span class="o">)</span><span class="n">Proxy</span><span class="o">.</span><span class="na">newProxyInstance</span><span class="o">(</span>
	<span class="n">getClass</span><span class="o">().</span><span class="na">getClassLoader</span><span class="o">(),</span>
  <span class="k">new</span> <span class="n">Class</span><span class="o">[]</span> <span class="o">{</span><span class="n">Object</span><span class="o">.</span><span class="na">class</span><span class="o">},</span> 
  <span class="k">new</span> <span class="n">SampleHandler</span><span class="o">(</span><span class="k">new</span> <span class="n">SampleTarget</span><span class="o">())</span>
<span class="o">);</span>
</code></pre></div><hr>
<p>다이나믹 프록시는 newProxyInstance 를 통해서만 생성이 가능하기 때문에 이를 스프링 빈으로 만들 수가 없습니다. 하지만 팩토리 빈의 getObject() 기능을 이용한다면 가능하게 됩니다.</p>
<p>이러한 프록시 팩토리 빈은 이전의 다이나믹 프록시의 문제점을 해결해 줄 수 있지만 이는 메소드 단위로 일어나는 부가기능 제공이기 때문에 하나의 클래스에는 적용하기가 쉬웠지만 여러 개의 클래스에 공통적인 부가기능을 부여 하는것은 거의 비슷한 프록시 팩토리 빈의 중복을 발생하게 합니다. 이는 곧 수많은 설정 파일과 Handler 오브젝트가 프록시 팩토리 빈의 갯수 만큼 만들어집니다.</p>
<p>스프링에서는 ProxyFactoryBean 이라는 프록시 오브젝트를 생성해주는 기술을 추상화한 팩토리 빈을 제공합니다.</p>
<p>이는 기존에 타겟 정보를 받아야 했던 InvocationHandler 와 달리 타겟 오브젝트가 담긴 MethodInvocation 오브젝트가 전달되는데 이는 콜백 오브젝트로 proceed() 메서도로 타깃 오브젝트의 메서드를 내부적으로 실행시켜주는 기능이 있어 앞의 프록시 팩토리 빈의 단점 중 하나인 새로운 부가기능을 추가할때 마다 프록시와 프록시 팩토리 빈을 추가 해줄 필요가 없게 됩니다.</p>
<p>이처럼 타겟 오브젝트의 부가기능을 담은 오브젝트를 어드바이스라고 부릅니다. 또한 부가기능 대상을 적용하는 메서드를 알고리즘으로 담은 오브젝트를 포인트 컷이라고 부릅니다.</p>
<p>프록시 팩토리 빈의 코드에서 이런 어드바이스를 등록할 때는 어드바이저 라고 하는 형태로 등록하게 되는데 이는 포인트컷과 어드바이스를 합쳐서 같이 등록해야 합니다.</p>
</article>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
<script type="application/javascript" src='https://joungsik.github.io/js/toc.js'></script>
<link rel="stylesheet" href='https://joungsik.github.io/css/toc.css' />


  <div class="footer container-xl width-full p-responsive">
  <div
    class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
    <a aria-label="Homepage" title="GitHub" class="footer-octicon d-none d-lg-block mr-lg-4" href="https://joungsik.github.io/">
      <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24">
        <path fill-rule="evenodd"
          d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
        </path>
      </svg>
    </a>
    <ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
      
      <li class="mr-3 mr-lg-0">Theme by <a href='https://github.com/MeiK2333/github-style'>github-style</a></li>
      
    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>


</div>
</body>

<script type="application/javascript" src="https://joungsik.github.io/js/github-style.js"></script>



</html>