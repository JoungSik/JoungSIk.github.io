<!DOCTYPE html>
<html lang="ko-kr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script type="application/javascript" src='https://joungsik.github.io/js/theme-mode.js'></script>
    <link rel="stylesheet" href='https://joungsik.github.io/css/frameworks.min.css' />
    <link rel="stylesheet" href='https://joungsik.github.io/css/github.min.css' />
    <link rel="stylesheet" href='https://joungsik.github.io/css/github-style.css' />
    <link rel="stylesheet" href='https://joungsik.github.io/css/light.css' />
    <link rel="stylesheet" href='https://joungsik.github.io/css/dark.css' />
    <link rel="stylesheet" href='https://joungsik.github.io/css/syntax.css' />
    <title>토비의 스프링 - 5장 - JoungSik</title>
    
    <link rel="icon" type="image/x-icon" href='/images/github.png'>
    
    <meta name="theme-color" content="#1e2327">
    <meta name="naver-site-verification" content="897620aba8ba7aa292baac576c13b337c3c0b021" />

    
    <meta name="description"
  content="토비의 스프링 - 5장" />
<meta name="keywords"
  content='spring' />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://joungsik.github.io/post/2022_01_04/" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="토비의 스프링 - 5장 - JoungSik" />
<meta name="twitter:description"
  content="토비의 스프링 - 5장" />
<meta name="twitter:site" content="https://joungsik.github.io/" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image"
  content="https://joungsik.github.io/">


<meta property="og:type" content="article" />
<meta property="og:title" content="토비의 스프링 - 5장 - JoungSik">
<meta property="og:description"
  content="토비의 스프링 - 5장" />
<meta property="og:url" content="https://joungsik.github.io/post/2022_01_04/" />
<meta property="og:site_name" content="토비의 스프링 - 5장" />
<meta property="og:image"
  content="https://joungsik.github.io/">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2022-01-04 23:20:28 &#43;0900 KST" />











<script async src="https://www.googletagmanager.com/gtag/js?id=G-DL4SWDGV72"></script>
<script>
  if (navigator.doNotTrack !== '1') {
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-DL4SWDGV72');
  }
</script>



</head>

<body>
  <div style="position: relative">
  <header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on">
    <div class="Header-item mobile-none" style="margin-top: -4px; margin-bottom: -4px;">
      <a class="Header-link" href="https://joungsik.github.io/">
        <svg class="octicon" height="32" viewBox="0 0 16 16" version="1.1" width="32">
          <path fill-rule="evenodd"
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
          </path>
        </svg>
      </a>
    </div>
    <div class="Header-item d-md-none">
      <button class="Header-link btn-link js-details-target" type="button"
        onclick="document.querySelector('#header-search').style.display = document.querySelector('#header-search').style.display == 'none'? 'block': 'none'">
        <svg height="24" class="octicon octicon-three-bars" viewBox="0 0 16 16" version="1.1" width="24">
          <path fill-rule="evenodd"
            d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z">
          </path>
        </svg>
      </button>
    </div>
    <div style="display: none;" id="header-search"
      class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex">
      <div
        class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to">
        <div class="position-relative">
          <form target="_blank" action="https://www.google.com/search" accept-charset="UTF-8" method="get"
            autocomplete="off">
            <label
              class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center">
              <input type="text"
                class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
                name="q" value="" placeholder="Search" autocomplete="off">
              <input type="hidden" name="q" value="site:https://joungsik.github.io/">
            </label>
          </form>
        </div>
      </div>
    </div>

    <div class="Header-item Header-item--full flex-justify-center d-md-none position-relative">
      <a class="Header-link " href="https://joungsik.github.io/">
        <svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" version="1.1"
          width="32">
          <path fill-rule="evenodd"
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
          </path>
        </svg>
      </a>
    </div>
    <div class="Header-item" style="margin-right: 0;">
      <a href="javascript:void(0)" class="Header-link no-select" onclick="switchTheme()">
        <svg style="fill: var(--color-profile-color-modes-toggle-moon);" class="no-select" viewBox="0 0 16 16"
          version="1.1" width="16" height="16">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z">
          </path>
        </svg>
      </a>
    </div>
  </header>
</div>
  
<div>
  <main>
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
      <div class="px-0">
        <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
          <div class="flex-auto min-width-0 width-fit mr-3">
            <div class="d-flex">
              <div class="d-none d-md-block">
                <a class="avatar mr-2 flex-shrink-0" href="https://joungsik.github.io/">
                  <img class=" avatar-user"
                    src="https://avatars.githubusercontent.com/u/6128807?v=4"
                    width="32" height="32"></a>
              </div>
              <div class="d-flex flex-column">
                <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                  <span class="author">
                    <a href="https://joungsik.github.io/">JoungSik</a></span><span
                    class="path-divider">/</span><strong class="css-truncate-target mr-1" style="max-width: 410px"><a
                      href="https://joungsik.github.io/post/2022_01_04/">토비의 스프링 - 5장</a></strong>
                </h1>
                <div class="note m-0">
                  Created <relative-time datetime="Tue, 04 Jan 2022 23:20:28 &#43;0900"
                    class="no-wrap">
                    Tue, 04 Jan 2022 23:20:28 &#43;0900</relative-time>

                  
                  <span class="file-info-divider"></span>
                  Modified <relative-time datetime="Mon, 10 Jan 2022 11:54:23 &#43;0900"
                    class="no-wrap">
                    Mon, 10 Jan 2022 11:54:23 &#43;0900</relative-time>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-lg px-3 new-discussion-timeline">
      <div class="repository-content gist-content">
        <div>
          <div class="js-gist-file-update-container js-task-list-container file-box">
            <div id="file-pytest" class="file my-2">
              <div id="post-header" class="file-header d-flex flex-md-items-center flex-items-start sticky-header" style="z-index: 2">
                <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
                  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                    
                    <summary id="toc-toggle" onclick="clickToc()" class="btn btn-octicon m-0 mr-2 p-2">
                      <svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16" class="octicon octicon-list-unordered">
                        <path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zM3 8a1 1 0 11-2 0 1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"></path>
                      </svg>
                    </summary>
                    <details-menu class="SelectMenu" id="toc-details" style="display: none;">
                      <div class="SelectMenu-modal rounded-3 mt-1" style="max-height: 340px;">
                        <div class="SelectMenu-list SelectMenu-list--borderless p-2" style="overscroll-behavior: contain;" id="toc-list">
                        </div>
                      </div>
                    </details-menu>
                      1851 Words
                    

                  </div>
                  <div class="file-actions flex-order-2 pt-0">
                    
                    
                    <a class="muted-link mr-3" href="/tags/spring">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      spring
                    </a>
                    
                    
                  </div>
                </div>
              </div>


              <div class="Box-body px-5 pb-5" style="z-index: 1">
                <article class="markdown-body entry-content container-lg"><h1 id="토비의-스프링---5장">토비의 스프링 - 5장</h1>
<p>이번 장에서는 서비스의 추상화에 대해서 알아보겠습니다.</p>
<p>책에 대한 내용을 정리하기 전에 비지니스 로직에 대해서 알아보겠습니다. 비지니스 로직은 유저에게 우리가 제공하는 서비스 (어플리케이션 혹은 웹 서비스) 에 대한 코드를 의미 합니다. 대표적인 예시로는 특정 쇼핑몰 사이트에서 신규 회원가입 시 할인 쿠폰을 발행 해주는 정책이 있을 때 회원가입 시 할인 쿠폰을 생성해 유저에게 할당하고 쿠폰 발행 여부를 메일, 문자 혹은 카카오 메세지를 통해 전송하는 코드가 비지니스 로직에 해당합니다.</p>
<p>이런 비지니스 로직은 기존의 DAO 에 코드를 넣기에는 역할과 책임에 맞지 않기 때문에 서비스 객체 라는 새로운 객체를 생성해 비지니스 로직에 대한 역할과 책임을 담당하게 됩니다.</p>
<p>위의 예시를 인용해보면 회원가입에 해당하는 유저 생성 로직은 UserDAO 에서 관리하고 쿠폰 생성 로직은 CouponDAO 에서 그리고 생성된 유저와 쿠폰을 이어주는 역할을 UserCouponDAO 라는 임의의 객체가 관리하게 됩니다. 그리고 회원가입을 하는 로직을 호출 했을 때 SignUpService 라는 객체가 UserDAO 와 CouponDAO 를 가져와 각각 유저와 쿠폰을 생성 후 UserCouponDAO 가 각각을 받아 유저와 쿠폰을 이어주고 쿠폰 발급 여부를 메일, 문자 혹은 카카오 메세지를 보내는 Message 객체를 통해 발송하는 객체들을 각자가 하는 역할에 맞게 작업을 요청하는 코드를 서비스 객체가 담당하게 됩니다.</p>
<p><img src="/post/2022_01/2022_01_04/1.png" alt="1"></p>
<p>이렇게 각 객체가 각자의 역할과 책임에 충실한 것을 단일 책임 원칙이라고 부르며 각 객체들에게 서로 작업을 요청 하는 부분이 객체 지향 프로그래밍에 있어서 가장 기본이 되는 원리라고 보면 됩니다. 이 경우 장점으로는 각자의 책임만을 담당하기 때문에 코드를 이해하기 쉽고 수정이 필요할 때 어디를 수정해야 하는지 좀 더 명확하게 할 수 있으며 각각을 독립적으로 테스트 하는 것 역시 가능하게 됩니다.</p>
<p>이러한 코드를 작성하고 항상 좋은 코드를 설계하기 위해서는 꾸준한 노력과 계속해서 개선하려고 하는 노력이 필요합니다.</p>
<hr>
<p>이제 서비스 객체를 알게 되었으니 본격적으로 서비스 객체의 추상화에 대해서 이야기 해보려고 합니다.</p>
<p>위에서는 메세지를 보내는 Message 객체를 가져온다고 했는데 여기서 어떤 메세지를 보낼지를 서비스 객체에서는 해당 내용을 담당하지 않고 메세지를 보낸다는 것만을 알고 있도록 의존성을 분리했습니다.</p>
<p>메세지를 발송 해야 하는 Message 객체도 메세지를 발송 한다는 기능만을 인터페이스로 추상화해 각각 SMTP 를 통한 메일 전송 로직을 구현하거나 카카오 계정이 있다면 카카오 메세지로 메세지를 전송하고 없다면 문자로 발송하는 로직을 구현하는 것처럼 특정 행동을 추상화하고 기능을 구현하고 이를 DI 를 통해 주입해 객체간의 영향을 주지 않고 확장하는 것을 서비스 객체의 추상화라고 합니다.</p>
<p>책에서는 트랜잭션 이라고 하는 더이상 나눌 수 없는 단위 작업을 통해 여러 개의 DB를 사용할 경우에 사용되는 JTA로 트랜잭션 서비스를 추상화 구현하고 있습니다.</p>
<p>트랜잭션은 대표적으로 DB를 예시로 들 수 있습니다.</p>
<p>트랜잭션의 핵심 중에는 원시성이라고 하는 더이상 나눌 수 없는 작은 단위 작업이 있는데 DB 에서는 SQL 단위로 처리하면 트랜잭션을 보장해줄 수 있습니다. 하지만 서비스를 운영 하다보면 이 트랜잭션을 SQL 이 아닌 기능 단위로 설정 해야 할 때가 있습니다.</p>
<p>그전에 용어를 잠시 살펴보겠습니다.</p>
<ul>
<li>경계 : 트랜잭션이 시작되고 종료되는 위치</li>
<li>커밋 : 여러 개의 SQL 을 하나의 트랜잭션으로 처리 할 때 모든 SQL 수행이 성공적으로 마무리 되면 DB에 알려 작업을 완료 시키는 것</li>
<li>롤백 : 여러 개의 SQL 을 하나의 트랜잭션으로 처리 할 때 이전 SQL 수행이 실패했을 때 이전 SQL 작업을 취소 시키는 것</li>
</ul>
<p>책의 예시를 인용하면 전체 회원의 등급 업그레이드를 할 경우 중간에 업그레이드에 실패하면 어디까지 회원 등급이 업그레이드 되었는지를 체크 하는게 아닌 하나의 트랜잭션으로 묶어 성공, 실패 여부를 확인하면 됩니다. 다른 예시로는 최근 1개월 가입 유저 중 신규 회원 감사 쿠폰을 배포할 경우에도 이를 하나의 트랜잭션으로 묶어 쿠폰을 생성하고, 발행 메세지를 보내는 것을 하나의 트랜잭션으로 묶으면 DB 에 값을 추가하는 트랜잭션, 추가된 쿠폰 발행 메세지를 보내는 트랜잭션으로 나눌 수 있습니다.</p>
<p>위에 나온 JTA 는 하나 이상의 DB에서 트랜잭션을 만들 때 이를 관리하도록 분산 트랜잭션을 위한 XA 프로토콜을 통해 이를 관리하는 API 입니다.</p>
<hr>
<p>마지막으로 테스트를 진행할 때 시스템의 다른 부분이 많이 얽혀 있고 의존해 있어 실제 객체를 만들어야 할 때 가짜 객체를 만들어 사용하는 방법으로 Mock 이라는게 있습니다.</p>
<p>이는 따로 객체를 생성해주지 않아도 되기 때문에 테스트 환경 구축이 어려울 때나 특정 경우나 순간에 의존 하는 경우에 크게 도움이 됩니다.</p>
<p>대표적으로는 메일 발송 로직에서 발송 되는 메일의 내용을 미리 볼 수 있도록 하는 경우가 있을 것 같습니다.</p>
<p>마지막으로 테스트가 수행될 때 특정 상태를 가정해 하드코딩 해둔 형태를 테스트 스텁이라고 하고 이런 스텁과 간접적인 출력까지 진행 해주는 목을 각각 목 오브젝트는 행위 검증, 스턱 오브젝트는 상태 검증에 사용합니다.</p>
</article>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
<script type="application/javascript" src='https://joungsik.github.io/js/toc.js'></script>
<link rel="stylesheet" href='https://joungsik.github.io/css/toc.css' />


  <div class="footer container-xl width-full p-responsive">
  <div
    class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
    <a aria-label="Homepage" title="GitHub" class="footer-octicon d-none d-lg-block mr-lg-4" href="https://joungsik.github.io/">
      <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24">
        <path fill-rule="evenodd"
          d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
        </path>
      </svg>
    </a>
    <ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
      
      <li class="mr-3 mr-lg-0">Theme by <a href='https://github.com/MeiK2333/github-style'>github-style</a></li>
      
    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>


</div>
</body>

<script type="application/javascript" src="https://joungsik.github.io/js/github-style.js"></script>



</html>