<!DOCTYPE html>
<html lang="ko-kr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script type="application/javascript" src='https://joungsik.github.io/js/theme-mode.js'></script>
    <link rel="stylesheet" href='https://joungsik.github.io/css/frameworks.min.css' />
    <link rel="stylesheet" href='https://joungsik.github.io/css/github.min.css' />
    <link rel="stylesheet" href='https://joungsik.github.io/css/github-style.css' />
    <link rel="stylesheet" href='https://joungsik.github.io/css/light.css' />
    <link rel="stylesheet" href='https://joungsik.github.io/css/dark.css' />
    <link rel="stylesheet" href='https://joungsik.github.io/css/syntax.css' />
    <title>토비의 스프링 - 6장 (4) - JoungSik</title>
    
    <link rel="icon" type="image/x-icon" href='/images/github.png'>
    
    <meta name="theme-color" content="#1e2327">
    <meta name="naver-site-verification" content="897620aba8ba7aa292baac576c13b337c3c0b021" />

    
    <meta name="description"
  content="토비의 스프링 - 6장 (4)" />
<meta name="keywords"
  content='spring' />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://joungsik.github.io/post/2022_02_06/" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="토비의 스프링 - 6장 (4) - JoungSik" />
<meta name="twitter:description"
  content="토비의 스프링 - 6장 (4)" />
<meta name="twitter:site" content="https://joungsik.github.io/" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image"
  content="https://joungsik.github.io/">


<meta property="og:type" content="article" />
<meta property="og:title" content="토비의 스프링 - 6장 (4) - JoungSik">
<meta property="og:description"
  content="토비의 스프링 - 6장 (4)" />
<meta property="og:url" content="https://joungsik.github.io/post/2022_02_06/" />
<meta property="og:site_name" content="토비의 스프링 - 6장 (4)" />
<meta property="og:image"
  content="https://joungsik.github.io/">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2022-02-06 23:28:13 &#43;0900 KST" />











<script async src="https://www.googletagmanager.com/gtag/js?id=G-DL4SWDGV72"></script>
<script>
  if (navigator.doNotTrack !== '1') {
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-DL4SWDGV72');
  }
</script>



</head>

<body>
  <div style="position: relative">
  <header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on">
    <div class="Header-item mobile-none" style="margin-top: -4px; margin-bottom: -4px;">
      <a class="Header-link" href="https://joungsik.github.io/">
        <svg class="octicon" height="32" viewBox="0 0 16 16" version="1.1" width="32">
          <path fill-rule="evenodd"
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
          </path>
        </svg>
      </a>
    </div>
    <div class="Header-item d-md-none">
      <button class="Header-link btn-link js-details-target" type="button"
        onclick="document.querySelector('#header-search').style.display = document.querySelector('#header-search').style.display == 'none'? 'block': 'none'">
        <svg height="24" class="octicon octicon-three-bars" viewBox="0 0 16 16" version="1.1" width="24">
          <path fill-rule="evenodd"
            d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z">
          </path>
        </svg>
      </button>
    </div>
    <div style="display: none;" id="header-search"
      class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex">
      <div
        class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to">
        <div class="position-relative">
          <form target="_blank" action="https://www.google.com/search" accept-charset="UTF-8" method="get"
            autocomplete="off">
            <label
              class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center">
              <input type="text"
                class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
                name="q" value="" placeholder="Search" autocomplete="off">
              <input type="hidden" name="q" value="site:https://joungsik.github.io/">
            </label>
          </form>
        </div>
      </div>
    </div>

    <div class="Header-item Header-item--full flex-justify-center d-md-none position-relative">
      <a class="Header-link " href="https://joungsik.github.io/">
        <svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" version="1.1"
          width="32">
          <path fill-rule="evenodd"
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
          </path>
        </svg>
      </a>
    </div>
    <div class="Header-item" style="margin-right: 0;">
      <a href="javascript:void(0)" class="Header-link no-select" onclick="switchTheme()">
        <svg style="fill: var(--color-profile-color-modes-toggle-moon);" class="no-select" viewBox="0 0 16 16"
          version="1.1" width="16" height="16">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z">
          </path>
        </svg>
      </a>
    </div>
  </header>
</div>
  
<div>
  <main>
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
      <div class="px-0">
        <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
          <div class="flex-auto min-width-0 width-fit mr-3">
            <div class="d-flex">
              <div class="d-none d-md-block">
                <a class="avatar mr-2 flex-shrink-0" href="https://joungsik.github.io/">
                  <img class=" avatar-user"
                    src="https://avatars.githubusercontent.com/u/6128807?v=4"
                    width="32" height="32"></a>
              </div>
              <div class="d-flex flex-column">
                <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                  <span class="author">
                    <a href="https://joungsik.github.io/">JoungSik</a></span><span
                    class="path-divider">/</span><strong class="css-truncate-target mr-1" style="max-width: 410px"><a
                      href="https://joungsik.github.io/post/2022_02_06/">토비의 스프링 - 6장 (4)</a></strong>
                </h1>
                <div class="note m-0">
                  Created <relative-time datetime="Sun, 06 Feb 2022 23:28:13 &#43;0900"
                    class="no-wrap">
                    Sun, 06 Feb 2022 23:28:13 &#43;0900</relative-time>

                  
                  <span class="file-info-divider"></span>
                  Modified <relative-time datetime="Sat, 12 Mar 2022 17:02:33 &#43;0900"
                    class="no-wrap">
                    Sat, 12 Mar 2022 17:02:33 &#43;0900</relative-time>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-lg px-3 new-discussion-timeline">
      <div class="repository-content gist-content">
        <div>
          <div class="js-gist-file-update-container js-task-list-container file-box">
            <div id="file-pytest" class="file my-2">
              <div id="post-header" class="file-header d-flex flex-md-items-center flex-items-start sticky-header" style="z-index: 2">
                <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
                  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                    
                    <summary id="toc-toggle" onclick="clickToc()" class="btn btn-octicon m-0 mr-2 p-2">
                      <svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16" class="octicon octicon-list-unordered">
                        <path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zM3 8a1 1 0 11-2 0 1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"></path>
                      </svg>
                    </summary>
                    <details-menu class="SelectMenu" id="toc-details" style="display: none;">
                      <div class="SelectMenu-modal rounded-3 mt-1" style="max-height: 340px;">
                        <div class="SelectMenu-list SelectMenu-list--borderless p-2" style="overscroll-behavior: contain;" id="toc-list">
                        </div>
                      </div>
                    </details-menu>
                      1340 Words
                    

                  </div>
                  <div class="file-actions flex-order-2 pt-0">
                    
                    
                    <a class="muted-link mr-3" href="/tags/spring">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      spring
                    </a>
                    
                    
                  </div>
                </div>
              </div>


              <div class="Box-body px-5 pb-5" style="z-index: 1">
                <article class="markdown-body entry-content container-lg"><h1 id="토비의-스프링---6장-4">토비의 스프링 - 6장 (4)</h1>
<p>AOP 로 시작했던 6장의 마지막 내용입니다.</p>
<p>AOP의 예시로 트랜잭션을 구현했었는데 트랜잭션의 경계안에서 진행된 작업이 전부 commit 되거나 전부 rollback 되어야 한다. 그런데 이런 트랜잭션의 동작 방식을 제어 할 수 있는 속성이 있습니다.</p>
<p>이는 다음과 같습니다.</p>
<ol>
<li>
<p>트랜잭션 전파</p>
<p>독자적인 트랜잭션 경계를 가진 코드가 이미 진행중인 트랜잭션이 어떻게 영향을 미칠 수 있는가를 정의하는 것으로 각각의 트랜잭션 경계를 가진 트랜잭션들이 겹쳤을 때 트랜잭션을 어떻게 관리 할지를 의미합니다.</p>
<ul>
<li>PROPAGATION_REQUIRED : 진행중인 트랜잭션이 없으면 새로 생성하고 진행중인 트랜잭션이 있다면 이에 참여함</li>
<li>PROPAGATION_REQUIRES_NEW : 앞서 진행중인 트랜잭션이 있어도 새로 생성해 독자적으로 동작하게 됨</li>
<li>PROPAGATION_NOT_SUPPORTED : 트랜잭션 없이 동작하도록 하는 것
<ul>
<li>AOP 를 통한 트랜잭션 경계설정은 보통 한번에 많은 메소드를 동시에 적용하기 위해 사용하는데 특별한 메소드만 적용에서 제외할 때 사용</li>
</ul>
</li>
</ul>
</li>
<li>
<p>격리수준</p>
<p>서버 환경에서의 트랜잭션은 동시에 진행 될 수 있는데 이 때의 트랜잭션들이 서로 변경한 데이터를 볼 수 있을지 말지를 결정하는 것을 의미합니다. 일반적으로는 DB의 트랜잭션 격리수준을 따라가는 편이 좋습니다. 다만 특별한 작업을 하는 메소드라면 독자적인 격리수준을 지정할 필요가 있습니다.</p>
<p>크게 4개로 나뉩니다.</p>
<ul>
<li>READ UNCOMMITTED : 커밋 이전에도 데이터 조회가 가능합니다.</li>
<li>READ COMMITTED : 커밋 이후에만 데이터 조회가 가능합니다.</li>
<li>REPETABLE READ : 트랜잭션이 시작되기 전의 커밋된 내용에 대해서만 조회할 수 있습니다.</li>
<li>SERIALZABLE : 읽기 작업만 하는 트랜잭션도 데이터가 잠금되어 조회할 수 없습니다.</li>
</ul>
</li>
<li>
<p>제한시간</p>
<p>트랜잭션 수행 시의 제한시간을 설정하는걸 의미합니다.</p>
</li>
<li>
<p>읽기전용</p>
<p>트랜잭션 내에서의 데이터 조작 시도를 막아줄 수 있습니다.</p>
</li>
</ol>
<p>다음은 트랜잭션 속성을 적용할 때의 이야기 입니다. 기본 원리는 이전의 메소드 이름 패턴에 따라 트랜잭션 적용 여부를 판단했던 것처럼 메소드 이름 패턴에 따라 다른 트랜잭션 정의가 적용되면 됩니다.</p>
<p>TransactionInterceptor 의 transactionAttributes 인터페이스를 통해 속성을 정의하고 예외처리를 통해 속성을 제어합니다. 그리고 Properties 라는 맵 형태의 오브젝트를 TransactionInterceptor 이 전달받아 메소드 패턴에 따라 각기 다른 트랜잭션 속성을 부여합니다.</p>
<p>마지막으로 프록시 방식의 AOP를 사용할 때 주의점이 있습니다.</p>
<p>클라이언트에서 프록시를 통해 메소드를 호출 할때는 부가기능이 이루어지게 되는데 문제는 오브젝트가 자기 자신의 메소드를 호출 할때는 프록시를 통한 호출이 아니기 때문에 부가기능의 적용이 일어나지 않게 됩니다.</p>
<hr>
<p>이렇게 세밀한 트랜잭션 속성 제어가 필요할 때를 대비해 스프링에서는 직접 타겟에 어노테이션을 지정하는 방법이 있습니다.</p>
<p>@Transactional 을 통해서 정의하게 됩니다. 이때 적용 단위는 메소드 단위로 메소드마다 어노테이션을 부여할 수 있습니다. 다만 이런 어노테이션을 많이 사용할 수록 코드가 지저분해 질 수도 있습니다.</p>
<p>프록시 AOP 의 종류와 특징, 비 프로식시 방식 AOP 의 동작원리를 잘 파악하고 @Transactional 의 적용 대상을 잘 관리 해줄 수 있다면 인터페이스에 @Transactional 을 적용하고 사용해도 됩니다.</p>
<p>이전의 AOP를 사용해 코드 외부에서 트랜잭션 기능을 부여하는 것을 선언적 트랜잭션, 반대의 경우를 프로그램에 의한 트랜잭션이라고 합니다.</p>
<p>이런 프로그램에 의한 트랜잭션을 사용하기 좋은 장소는 테스트인데 이는 메소드 단위로 테스트를 진행하기에 굉장히 유용하게 사용됩니다.</p>
<p>유용하게 사용되는 어노테이션으로 롤백 기능을 제어하기 위한 @Rollback 과 테스트 클래스의 모든 테스트 메소드 일괄 적용을 위한 @TransactionConfiguration 이 있습니다. 그리고 일부 메소드 중 트랜잭션을 시작하지 않은 채로 테스트를 진행하는 @NotTransactional 이 있습니다.</p>
</article>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
<script type="application/javascript" src='https://joungsik.github.io/js/toc.js'></script>
<link rel="stylesheet" href='https://joungsik.github.io/css/toc.css' />


  <div class="footer container-xl width-full p-responsive">
  <div
    class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
    <a aria-label="Homepage" title="GitHub" class="footer-octicon d-none d-lg-block mr-lg-4" href="https://joungsik.github.io/">
      <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24">
        <path fill-rule="evenodd"
          d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
        </path>
      </svg>
    </a>
    <ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
      
      <li class="mr-3 mr-lg-0">Theme by <a href='https://github.com/MeiK2333/github-style'>github-style</a></li>
      
    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>


</div>
</body>

<script type="application/javascript" src="https://joungsik.github.io/js/github-style.js"></script>



</html>